name: Deploy Release

on:
  push:
    branches:
      - dev 
  workflow_dispatch:

jobs:
  deploy:
    uses: Prestek/central-pipelines/.github/workflows/deploy.yml@V0.0.2
    with:
      PROJECT_NAME: "PeopleService"       # Nombre de la carpeta/proyecto en la instancia EC2
      IMAGE_NAME: "people-service"                  # Nombre de la imagen Docker
      CONTAINER_NAME: "people-service"              # Nombre del contenedor Docker
      PORT: "8080"                        # Puerto en el que se expondrÃ¡ el contenedor
      REPO_URL: "https://github.com/Prestek/PeopleService.git"  # URL del repositorio a desplegar
      BRANCH: "dev"                      
    secrets:
      EC2_SSH_KEY: ${{ secrets.EC2_SSH_KEY }}
      EC2_HOST: ${{ secrets.EC2_HOST }}
      EC2_USER: ${{ secrets.EC2_USER }}
      AWS_SECRET_ARN: ${{ secrets.AWS_SECRET_ARN }}

    steps:
      - name: ðŸš€ Checkout del repositorio (para disponer de este workflow)
        uses: actions/checkout@v4

      - name: ðŸ“‚ Conectar por SSH y desplegar en EC2
        env:
          PRIVATE_KEY: ${{ secrets.EC2_SSH_KEY }}
          EC2_HOST: ${{ secrets.EC2_HOST }}
          EC2_USER: ${{ secrets.EC2_USER }}
          AWS_SECRET_ARN: ${{ secrets.AWS_SECRET_ARN }}
          IMAGE_NAME: ${{ inputs.IMAGE_NAME }}
          CONTAINER_NAME: ${{ inputs.CONTAINER_NAME }}
          PORT: ${{ inputs.PORT }}
          REPO_URL: ${{ inputs.REPO_URL }}
          PROJECT_NAME: ${{ inputs.PROJECT_NAME }}
          BRANCH: ${{ inputs.BRANCH }}
        run: |
          echo "$PRIVATE_KEY"
